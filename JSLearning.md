### é¢è¯•

#### 1.JSçš„åŸºæœ¬æ•°æ®ç±»å‹

- åŸºæœ¬æ•°æ®ç±»å‹(å€¼ç±»å‹)ï¼š
- å¤æ‚æ•°æ®ç±»å‹(å¼•ç”¨ç±»å‹)ï¼š

#### 2.nullå’Œundefinedçš„åŒºåˆ«

- `null`è¡¨ç¤ºå¯¹è±¡è¢«å®šä¹‰äº†ï¼Œä½†æ˜¯å€¼æ˜¯â€˜ç©ºå€¼â€™ï¼šç”¨æ³•
  - ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œè¡¨ç¤ºå‡½æ•°çš„å‚æ•°ä¸æ˜¯å¯¹è±¡
  - **ä½œä¸ºå¯¹è±¡åŸå‹é“¾çš„ç»ˆç‚¹**
- `undefined`è¡¨ç¤ºä¸å­˜åœ¨è¿™ä¸ªå€¼ï¼Œå°±æ˜¯æ­¤å¤„åº”è¯¥æœ‰ä¸ªå€¼ï¼Œä½†æ˜¯è¿˜æ²¡å®šä¹‰ï¼Œå°è¯•è¯»å–å°±ä¼šè¿”å›undefinedï¼Œç”¨æ³•ï¼š
  - å‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œé»˜è®¤è¿”å›undefined
  - å˜é‡å·²å£°æ˜ï¼Œä½†æ²¡èµ‹å€¼ï¼Œä¼šè¿”å›undefined
  - å¯¹è±¡ä¸­æ²¡æœ‰èµ‹å€¼çš„å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼ä¸ºundefined
  - è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ²¡æœ‰æä¾›å¿…éœ€çš„å‚æ•°ï¼Œå‚æ•°ç­‰äºundefined

####3.åˆ¤æ–­JSçš„æ•°æ®ç±»å‹

1. typeof:å¯ä»¥åˆ¤æ–­nullä»¥å¤–çš„å…¶ä»–åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä»¥åŠä»å¯¹è±¡ç±»å‹ä¸­è¯†åˆ«å‡ºå‡½æ•°(function)
2. instanceofï¼šä¸€èˆ¬ç”¨æ¥åˆ¤æ–­å¼•ç”¨æ•°æ®ç±»å‹ï¼Œä½†ä¸èƒ½æ­£ç¡®åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ ¹æ®åœ¨åŸå‹é“¾ä¸­æŸ¥æ‰¾åˆ¤æ–­å½“å‰çš„åŸå‹å¯¹è±¡æ˜¯å¦å­˜åœ¨è¿”å›å¸ƒå°”å€¼
3. Object.prototype.toStringï¼šå¯æ­£ç¡®åˆ¤æ–­æ‰€æœ‰ç±»å‹ï¼Œå¹¶æ˜¾ç¤ºæ‰€å±ç±»å‹
4. `Array.isArray`ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯æ•°å€¼
5. `.Constructor`

#### 4.==å’Œ===çš„åŒºåˆ«

#### 5.å¦‚ä½•éå†å¯¹è±¡çš„å±æ€§

1. Object.keys()
2. Object.getOwnPropertyNames()
3. for...in

#### 6.å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰

#### 7.åŸå‹å’ŒåŸå‹é“¾

jsæ˜¯é¢å‘å¯¹è±¡çš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªprotoå±æ€§ï¼Œè¯¥å±æ€§æŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ã€‚è¯¥å®ä¾‹çš„æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªprototypeåŸå‹å±æ€§ï¼Œä¸å®ä¾‹çš„protoæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚åŒæ—¶ï¼ŒåŸå‹å¯¹è±¡çš„constructoræŒ‡å‘æ„é€ å‡½æ•°æœ¬èº«

```mermaid
graph TD;
f1=newFoo-->|__proto__|Foo.prototype;
Functionçš„Foo-->|prototype|Foo.prototype;
Foo.prototype-->|constructor|Functionçš„Foo;
```

å½“ä¸€ä¸ªå¯¹è±¡æŸ¥æ‰¾æŸä¸ªå±æ€§æ—¶ï¼Œè‹¥è‡ªèº«æ²¡æœ‰å°±ä¼šæ ¹æ®__proto__å±æ€§å»å‘ä¸Šå»åŸå‹æŸ¥æ‰¾ï¼Œè‹¥è¿˜æ˜¯æ²¡æœ‰ï¼Œå°±å‘åŸå‹çš„åŸå‹å»æŸ¥æ‰¾ï¼Œç›´è‡³æŸ¥åˆ°`Object.prototype.__proto__`ä¹Ÿå°±æ˜¯`null`ï¼Œè¿™æ ·å°±å½¢æˆäº†`åŸå‹é“¾`ã€‚

#### 8.é—­åŒ…

#### 9.newæ“ä½œç¬¦çš„å®ç°æœºåˆ¶

#### 10.thisçš„ç†è§£

- ä¸‹é¢æ˜¯æ•´ç†å¥½çš„ **Markdown å½¢å¼å†…å®¹**ï¼š

  ---

  ## ğŸ“Œ å„ç§ç»‘å®šæ–¹å¼è¯¦ç»†è¯´æ˜

  ### 1. æ˜¾å¼ç»‘å®šï¼ˆcall / apply / bindï¼‰

  ```js
  function greet() {
    console.log(this.name);
  }
  
  const person = { name: 'Alice' };
  
  greet.call(person);   // Alice
  greet.apply(person);  // Alice
  const bound = greet.bind(person);
  bound();              // Alice
  ```

  ------

  ### 2. æ„é€ å‡½æ•°ç»‘å®šï¼ˆnewï¼‰

  ```js
  function Person(name) {
    this.name = name;
  }
  
  const p = new Person('Tom');
  console.log(p.name); // Tom
  ```

  ------

  ### 3. éšå¼ç»‘å®šï¼ˆä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼‰

  ```js
  const obj = {
    name: 'Bob',
    sayHi() {
      console.log(this.name);
    }
  };
  
  obj.sayHi(); // Bob
  ```

  #### âœ… åˆ¤å®šæ–¹æ³•ï¼š

  - å¦‚æœå‡½æ•°æ˜¯é€šè¿‡ `obj.fn()` çš„å½¢å¼è°ƒç”¨çš„ï¼Œ`this` å°±æŒ‡å‘ `obj`ã€‚
  - å£è¯€ï¼š**è°ç‚¹çš„æˆ‘ï¼Œæˆ‘å°±æ˜¯è°**

  ------

  ### 4. é»˜è®¤ç»‘å®šï¼ˆæ™®é€šå‡½æ•°ç›´æ¥è°ƒç”¨ï¼‰

  ```js
  function test() {
    console.log(this);
  }
  
  test(); // éä¸¥æ ¼æ¨¡å¼: windowï¼›ä¸¥æ ¼æ¨¡å¼: undefined
  ```

  ------

  ### 5. éšå¼ä¸¢å¤±ï¼ˆé€€åŒ–ä¸ºé»˜è®¤ç»‘å®šï¼‰

  ```js
  const obj = {
    name: 'Charlie',
    greet() {
      console.log(this.name);
    }
  };
  
  const fn = obj.greet;
  fn(); // undefinedï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰
  ```

  #### åŸå› ï¼š

  - èµ‹å€¼æ—¶å‡½æ•°è„±ç¦»äº†å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œä¸å†æ˜¯ `obj.fn()` çš„å½¢å¼ï¼Œå› æ­¤é€€åŒ–ä¸ºé»˜è®¤ç»‘å®šã€‚

  ### 6.ç®­å¤´å‡½æ•°çš„thisç»‘å®š

  ```js
  // ç®­å¤´å‡½æ•°çš„æ–¹æ³•ä¸¢å¤±ç»‘å®š
  const obj = {
    x: 10,
    method() {
      const arrow = () => console.log(this.x);
      return arrow;
    }
  };
  
  const fn = obj.method(); 
  fn(); // 10
  // ç®­å¤´å‡½æ•°åœ¨æ–¹æ³•é‡Œè°ƒç”¨
  const obj = {
    x: 10,
    method() {
      const arrow = () => {
        console.log(this.x);
      };
      arrow();
    }
  };
  obj.method(); // 10
  ```

  #### ç»“è®ºï¼šä»¥ä¸Šthiséƒ½æ˜¯obj

  #### åŸå› ï¼šç®­å¤´å‡½æ•°çš„thisä¸åŒäºæ™®é€šå‡½æ•°çš„thisï¼Œå®ƒæ˜¯åœ¨å®šä¹‰æ—¶æ•è·çš„ï¼Œå®šä¹‰æ—¶æ‰¾åˆ°å¤–å±‚æœ€è¿‘çš„éç®­å¤´å‡½æ•°ï¼Œç›´æ¥æ•è·ã€‚è€Œæ™®é€šå‡½æ•°åœ¨ä¸Šè¿°å¯¹è±¡æ–¹æ³•ä¸­æ˜¯è°ƒç”¨æ—¶å†³å®šçš„ã€‚
  
  

  ------

  ## ğŸ§  å°ç»“å£è¯€
  
  > ğŸ§¾ â€œè°ç‚¹çš„æˆ‘ï¼Œæˆ‘å°±æ˜¯è°ã€‚â€ï¼ˆéšå¼ç»‘å®šï¼‰
  >  ğŸ§¾ â€œä¸¢äº†å¯¹è±¡å°±æ˜¯é»˜è®¤ç»‘ã€‚â€ï¼ˆéšå¼ä¸¢å¤±ï¼‰
  >  ğŸ§¾ â€œcallã€applyã€bind æ˜¯æ˜¾å¼ã€‚â€
  >  ğŸ§¾ â€œnew å°±æŒ‡å‘æ–°å¯¹è±¡ã€‚â€
  >  ğŸ§¾ â€œç®­å¤´å‡½æ•°ä¸ç»‘å®š thisã€‚å®šä¹‰æ—¶å°±æ•è·thisç»‘å®šçš„å¯¹è±¡â€
  
  ------
  
  ## âš ï¸ æµç¨‹å›¾å¸¸è§é”™è¯¯è¯´æ˜
  
  è®¸å¤šç‰ˆæœ¬çš„ `this` å†³ç­–å›¾ä¸­ï¼Œæœ‰å¦‚ä¸‹é”™è¯¯ï¼š
  
  > âŒ â€œIs the function called as a method?â€ â†’ Yes â†’ Default Binding
  
  è¿™æ˜¯ **é”™è¯¯çš„**ã€‚
   **æ­£ç¡®åº”ä¸ºï¼šYes â†’ éšå¼ç»‘å®šï¼ˆthis = å¯¹è±¡ï¼‰**
  
  ------
  
  ## âœ… ç»“è¯­
  
  æŒæ¡ `this` çš„ç»‘å®šè§„åˆ™ï¼Œæ ¸å¿ƒæ˜¯ç†è§£è°ƒç”¨æ–¹å¼ï¼Œè€Œä¸æ˜¯å®šä¹‰ä½ç½®ã€‚
  
  å»ºè®®å¤šåšå®è·µé¢˜ï¼Œå¦‚ï¼š
  
  - `setTimeout` å›è°ƒä¸­çš„ `this`
  - å¯¹è±¡æ–¹æ³•èµ‹å€¼åè°ƒç”¨
  - ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°æ··åˆåœºæ™¯
  
  ä¹Ÿå¯ä»¥ç»˜åˆ¶ä¸€å¼ è‡ªå·±çš„æµç¨‹å›¾åŠ å¼ºè®°å¿†ã€‚
  
  ```
  ---
  
  å¦‚æœä½ è¿˜éœ€è¦æ·»åŠ å›¾ç¤ºã€ç”¨è‹±æ–‡ç‰ˆæœ¬ï¼Œæˆ–åšæˆæ•™å­¦ç¬”è®°ç­‰å½¢å¼ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¸®ä½ ç»§ç»­æ•´ç†ï¼
  ```

#### 11.call,apply,bindçš„åŒºåˆ«ä»¥åŠæ‰‹å†™å®ç°

- call:
- apply:
- bind:
- **call,applyéƒ½æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œbindä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªä¿®æ”¹thisä¹‹åçš„å‡½æ•°**
- **callå’Œbindçš„ç¬¬äºŒä¸ªå‚æ•°éƒ½æ˜¯åˆ—è¡¨å½¢å¼ï¼Œapplyçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„å½¢å¼**

#### 12.ç®­å¤´å‡½æ•°

- æ˜¯ä¸€ç§å®šä¹‰å‡½æ•°çš„æ–°çš„æ–¹å¼ï¼Œæ¯”æ™®é€šå‡½æ•°æ›´ç®€å•å’Œæ–¹ä¾¿
- æ•è·ä¸Šä¸‹æ–‡çš„this

- ä½¿ç”¨callï¼Œapplyï¼Œbindå¹¶ä¸ä¼šæ”¹å˜thisçš„æŒ‡å‘

#### 13.æµ…æ‹·è´å’Œæ·±æ‹·è´çš„å®ç°

- æ·±æ‹·è´

åœ¨ JavaScript ä¸­å®ç°æ·±æ‹·è´ï¼ˆDeep Copyï¼‰å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼ï¼Œä¸‹é¢ç»™å‡ºä¸¤ç§å¸¸è§çš„å®ç°æ–¹å¼ï¼š

1. ä½¿ç”¨ JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–
```javascript
function deepCopy(obj) {
  return JSON.parse(JSON.stringify(obj));
}
```

ä¸Šè¿°ä»£ç é€šè¿‡å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å¯¹è±¡å®ç°æ·±æ‹·è´ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ JSON.stringify å’Œ JSON.parse çš„æ–¹å¼æœ‰ä¸€äº›é™åˆ¶ï¼š
- æ— æ³•æ‹·è´å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ—¥æœŸç­‰ç‰¹æ®Šå¯¹è±¡ã€‚
- ä¼šå¿½ç•¥ undefined å±æ€§ã€‚
- ä¼šå¿½ç•¥å¯¹è±¡çš„åŸå‹é“¾ã€‚

2. é€’å½’éå†å¯¹è±¡å±æ€§
```javascript
function deepCopy(obj) {
  if (typeof obj !== 'object' || obj === null) {
    return obj;
  }

  let copy;
  if (Array.isArray(obj)) {
    copy = [];
    for (let i = 0; i < obj.length; i++) {
      copy[i] = deepCopy(obj[i]);
    }
  } else {
    copy = {};
    for (let key in obj) {
      // è¿™é‡Œæ˜¯åˆ¤æ–­å¯¹è±¡å±æ€§æ˜¯å¦æ˜¯è‡ªèº«çš„ï¼Œå¹¶ä¸”ä½¿ç”¨callç»‘å®šåœ¨objä¸Šï¼Œç¡®ä¿ä¸ä¼šè¢«åŸå‹é“¾ä¸Šçš„å±æ€§å½±å“åˆ°
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        copy[key] = deepCopy(obj[key]);
      }
    }
  }

  return copy;
}
```

ä¸Šè¿°ä»£ç é€šè¿‡é€’å½’éå†å¯¹è±¡å±æ€§ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡å¹¶å¤åˆ¶å±æ€§å€¼ï¼Œå®ç°äº†æ·±æ‹·è´ã€‚å®ƒèƒ½å¤Ÿå¤„ç†åŒ…æ‹¬æ•°ç»„ã€å¯¹è±¡åœ¨å†…çš„å„ç§æƒ…å†µã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°ä»£ç ä»…é€‚ç”¨äºå¤„ç†æ™®é€šå¯¹è±¡å’Œæ•°ç»„ï¼Œå¯¹äºåŒ…å«å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰ç‰¹æ®Šå¯¹è±¡çš„æ·±æ‹·è´ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„å¤„ç†ã€‚

å¦å¤–ï¼Œæ·±æ‹·è´åœ¨å¤„ç†åµŒå¥—å±‚çº§è¾ƒæ·±æˆ–å¾ªç¯å¼•ç”¨çš„å¯¹è±¡æ—¶éœ€è¦æ ¼å¤–å°å¿ƒï¼Œé¿å…è¿›å…¥æ— é™é€’å½’çš„å¾ªç¯ã€‚

3. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ æ·±æ‹·è´çš„å®ç°æ¶‰åŠåˆ°é€’å½’éå†å¯¹è±¡çš„å±æ€§ï¼Œå¹¶å¤„ç†å„ç§æ•°æ®ç±»å‹å’Œç‰¹æ®Šæƒ…å†µã€‚ä¸ºäº†ç®€åŒ–å¼€å‘è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æˆç†Ÿçš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ lodash çš„ cloneDeep æ–¹æ³•æˆ– jQuery çš„ extend æ–¹æ³•ç­‰ã€‚è¿™äº›åº“æä¾›äº†æ–¹ä¾¿çš„æ·±æ‹·è´åŠŸèƒ½ï¼Œå¯ä»¥å¤„ç†å¤šç§æ•°æ®ç±»å‹å’Œè¾¹ç•Œæƒ…å†µã€‚

- æµ…æ‹·è´

åœ¨ JavaScript ä¸­å®ç°æµ…æ‹·è´ï¼ˆShallow Copyï¼‰å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼ï¼Œä¸‹é¢ç»™å‡ºä¸¤ç§å¸¸è§çš„å®ç°æ–¹å¼ï¼š

1. ä½¿ç”¨ Object.assign()
```javascript
function shallowCopy(obj) {
  return Object.assign({}, obj);
}
```

ä¸Šè¿°ä»£ç ä½¿ç”¨ `Object.assign()` æ–¹æ³•ï¼Œå°†åŸå§‹å¯¹è±¡çš„å±æ€§å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ä¸­ï¼Œå®ç°äº†æµ…æ‹·è´ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`Object.assign()` åªèƒ½å¤åˆ¶å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼Œå¹¶ä¸”åªèƒ½è¿›è¡Œæµ…æ‹·è´ã€‚

2. ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦
```javascript
function shallowCopy(obj) {
  return { ...obj };
}
```

ä¸Šè¿°ä»£ç ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ `...`ï¼Œå°†åŸå§‹å¯¹è±¡çš„å±æ€§å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­ï¼Œä¹Ÿå®ç°äº†æµ…æ‹·è´ã€‚æ‰©å±•è¿ç®—ç¬¦ä¼šå±•å¼€å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼Œå°†å®ƒä»¬å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­ã€‚

3. sliceï¼ˆé€‚ç”¨äºæ•°ç»„ï¼‰
4. concatï¼ˆé€‚ç”¨äºæ•°ç»„ï¼‰

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæµ…æ‹·è´åªå¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§å€¼æ˜¯å¼•ç”¨ç±»å‹ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ç­‰ï¼‰ï¼Œåˆ™ä»ç„¶æ˜¯æµ…æ‹·è´ï¼Œå³å¤åˆ¶çš„æ˜¯å¼•ç”¨è€Œéå€¼ã€‚ä¿®æ”¹åŸå§‹å¯¹è±¡æˆ–æ–°å¯¹è±¡çš„å¼•ç”¨ç±»å‹å±æ€§ä¼šç›¸äº’å½±å“ã€‚

æ€»ç»“èµ·æ¥ï¼Œæµ…æ‹·è´å¯ä»¥ä½¿ç”¨ `Object.assign()` æ–¹æ³•æˆ–æ‰©å±•è¿ç®—ç¬¦æ¥å®ç°ï¼Œä½†éœ€è¦æ³¨æ„å…¶é™åˆ¶å’Œå¯¹å¼•ç”¨ç±»å‹çš„å¤„ç†ã€‚å¦‚æœéœ€è¦å®ç°æ·±æ‹·è´ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰æåˆ°çš„æ·±æ‹·è´å®ç°æ–¹å¼ã€‚

#### 14.jså†…å­˜æ³„æ¼çš„å‡ ç§æƒ…å†µ

####15.é˜²æŠ–å’ŒèŠ‚æµçš„åŒºåˆ«ï¼Œä»¥åŠæ‰‹å†™å®ç°

#### 16.event loopäº‹ä»¶å¾ªç¯

#### 17.Promise

- ```javascript
  // è¿™æ˜¯ç±»ä¼¼äºpromiseä¸­allSettledçš„è§£å†³æ–¹æ³•,æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œå†è¾“å‡ºã€‚å¯æ§åˆ¶å¹¶å‘ä»»åŠ¡æ•°é‡ï¼Œä¸”æ¯ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ
  function runTasksInOrder(tasks, limit) {
    const results = new Array(tasks.length);
    let activeCount = 0;
    let currentIndex = 0;
  
    return new Promise((resolve, reject) => {
      const next = () => {
        if (currentIndex >= tasks.length && activeCount === 0) {
          // å…¨éƒ¨å®Œæˆ
          results.forEach(r => console.log(r)); // é¡ºåºè¾“å‡º
          return resolve(results);
        }
  
        while (activeCount < limit && currentIndex < tasks.length) {
          const taskIndex = currentIndex++;
          const task = tasks[taskIndex];
          activeCount++;
  
          task()
            .then(res => {
              results[taskIndex] = res;
            })
            .catch(reject)
            .finally(() => {
              activeCount--;
              next();
            });
        }
      };
  
      next();
    });
  }
  
  // æ¨¡æ‹Ÿä»»åŠ¡ï¼ˆä¸åŒè€—æ—¶ï¼‰
  const tasks = [
    () => new Promise(res => setTimeout(() => res('T1 done'), 300)),
    () => new Promise(res => setTimeout(() => res('T2 done'), 100)),
    () => new Promise(res => setTimeout(() => res('T3 done'), 150)),
    () => new Promise(res => setTimeout(() => res('T4 done'), 50)),
  ];
  
  runTasksInOrder(tasks, 2);
  
  // ç¬¬äºŒç§ï¼Œå°†å¤šä¸ªä»»åŠ¡æŒ‰ç…§å¹¶å‘ä»»åŠ¡çš„é™åˆ¶ å°½å¯èƒ½åœ¨æœ€çŸ­æ—¶é—´å†…å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œå¹¶ä¸”æŒ‰é¡ºåº**åŠæ—¶**è¾“å‡ºç»“æœï¼ˆä¸æ˜¯æœ€åä¸€èµ·è¾“å‡ºï¼‰
  function runTasksInOrderRealtime(tasks, limit) {
    const results = new Array(tasks.length);  // åªå­˜ç»“æœ
    let activeCount = 0;
    let currentIndex = 0;
    let nextPrintIndex = 0; // ä¸‹ä¸€ä¸ªè¦è¾“å‡ºçš„ä»»åŠ¡ç´¢å¼•
  
    const tryPrint = () => {
      while (results[nextPrintIndex] !== undefined) {
        console.log(results[nextPrintIndex]);
        nextPrintIndex++;
      }
    };
  
    return new Promise((resolve, reject) => {
      const next = () => {
        if (currentIndex >= tasks.length && activeCount === 0) {
          return resolve(results);
        }
  
        while (activeCount < limit && currentIndex < tasks.length) {
          const taskIndex = currentIndex++;
          activeCount++;
  
          tasks[taskIndex]()
            .then(res => {
              results[taskIndex] = res;
              tryPrint();
            })
            .catch(reject)
            .finally(() => {
              activeCount--;
              next();
            });
        }
      };
  
      next();
    });
  }
  
  // æ¨¡æ‹Ÿä¸åŒè€—æ—¶çš„ä»»åŠ¡
  const tasks = [
    () => new Promise(res => setTimeout(() => res('T1 done'), 300)),
    () => new Promise(res => setTimeout(() => res('T2 done'), 100)),
    () => new Promise(res => setTimeout(() => res('T3 done'), 150)),
    () => new Promise(res => setTimeout(() => res('T4 done'), 50)),
  ];
  
  runTasksInOrderRealtime(tasks, 2).then(() => {
    console.log('All tasks completed');
  });
  
  ```

  ------
  
  # ğŸ“š Promise çŸ¥è¯†ç‚¹æ•´ç†
  
  ## ä¸€ã€åŸºæœ¬æ¦‚å¿µ
  
  1. **å®šä¹‰**
     - `Promise` æ˜¯ä¸€ä¸ªä»£è¡¨å¼‚æ­¥æ“ä½œæœ€ç»ˆç»“æœçš„å¯¹è±¡ã€‚
     - ä¸‰ç§çŠ¶æ€ï¼š
       - `pending`ï¼ˆè¿›è¡Œä¸­ï¼‰
       - `fulfilled`ï¼ˆå·²æˆåŠŸï¼‰
       - `rejected`ï¼ˆå·²å¤±è´¥ï¼‰
     - çŠ¶æ€ä¸€æ—¦å˜æ›´ä¸å¯é€†ã€‚
  2. **æ ¸å¿ƒæ–¹æ³•**
     - `new Promise((resolve, reject) => {...})`
     - `then(onFulfilled, onRejected)`
     - `catch(onRejected)`
     - `finally(onFinally)`
  
  ------
  
  ## äºŒã€æ‰§è¡Œæœºåˆ¶
  
  1. **ç«‹å³æ‰§è¡Œ**
     - `Promise` æ„é€ å‡½æ•°å†…çš„ä»£ç ä¼šç«‹å³æ‰§è¡Œã€‚
  2. **å¾®ä»»åŠ¡æœºåˆ¶**
     - `.then/.catch/.finally` çš„å›è°ƒä¼šè¢«æ”¾å…¥ **å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼ˆmicrotask queueï¼‰ã€‚
     - å¾®ä»»åŠ¡æ€»æ˜¯ä¼˜å…ˆäºä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œã€‚
  3. **é“¾å¼è°ƒç”¨**
     - `then` è¿”å›ä¸€ä¸ªæ–°çš„ `Promise`ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€‚
     - è¿”å›å€¼è§„åˆ™ï¼š
       - è¿”å›æ™®é€šå€¼ â†’ è‡ªåŠ¨åŒ…è£…æˆ `Promise.resolve(å€¼)`
       - è¿”å› `Promise` â†’ ç­‰å¾…è¯¥ Promise ç»“æœ
       - æŠ›å‡ºé”™è¯¯ â†’ è¿›å…¥ä¸‹ä¸€ä¸ª `catch`
  
  ------
  
  ## ä¸‰ã€å¸¸ç”¨é™æ€æ–¹æ³•
  
  1. `Promise.resolve(value)`
     - å°†å€¼åŒ…è£…æˆå·²å®Œæˆçš„ Promiseã€‚
  2. `Promise.reject(reason)`
     - è¿”å›ä¸€ä¸ªå·²æ‹’ç»çš„ Promiseã€‚
  3. `Promise.all([p1, p2, ...])`
     - å¹¶å‘æ‰§è¡Œï¼Œæ‰€æœ‰æˆåŠŸæ‰æˆåŠŸï¼›æœ‰ä¸€ä¸ªå¤±è´¥åˆ™ç«‹å³å¤±è´¥ã€‚
  4. `Promise.race([p1, p2, ...])`
     - è¿”å›ç¬¬ä¸€ä¸ªå®Œæˆçš„ç»“æœï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰ã€‚
  5. `Promise.allSettled([p1, p2, ...])`
     - ç­‰å¾…æ‰€æœ‰å®Œæˆï¼Œè¿”å›æ¯ä¸ªç»“æœçš„çŠ¶æ€å’Œæ•°æ®ã€‚
  6. `Promise.any([p1, p2, ...])`
     - åªè¦æœ‰ä¸€ä¸ªæˆåŠŸå°±è¿”å›ï¼›å…¨å¤±è´¥åˆ™è¿”å› `AggregateError`ã€‚
  
  ------
  
  ## å››ã€æ‰‹å†™å®ç°è¦ç‚¹ï¼ˆPromise/A+ï¼‰
  
  1. **çŠ¶æ€æœº**ï¼špending â†’ fulfilled / rejected
  2. **then é“¾å¼è°ƒç”¨**ï¼šæ¯ä¸ª then è¿”å›æ–° Promise
  3. **å›è°ƒå­˜å‚¨é˜Ÿåˆ—**ï¼špending æ—¶å­˜èµ·æ¥ï¼Œç­‰çŠ¶æ€å˜åŒ–å†è°ƒç”¨
  4. **å¼‚æ­¥æ‰§è¡Œ**ï¼šå›è°ƒå¿…é¡»æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œ
  
  ------
  
  ## äº”ã€ä¸ async/await çš„å…³ç³»
  
  1. `async function` é»˜è®¤è¿”å›ä¸€ä¸ª `Promise`ã€‚
  
  2. `await expr` ç›¸å½“äºï¼š
  
     ```js
     Promise.resolve(expr).then(value => {
       // ç»§ç»­æ‰§è¡Œ
     });
     ```
  
  3. `await` ä¼šæš‚åœ async å‡½æ•°ï¼Œé‡Šæ”¾ä¸»çº¿ç¨‹ï¼Œç­‰ Promise resolve åç»§ç»­ã€‚
  
  ------
  
  ## å…­ã€å®æˆ˜åº”ç”¨
  
  1. **å°è£…å¼‚æ­¥è¯·æ±‚**ï¼ˆæ¥å£è°ƒç”¨ï¼‰
  2. **å¹¶å‘æ§åˆ¶**ï¼ˆé™æµå™¨ã€ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  3. **é‡è¯•æœºåˆ¶**ï¼ˆå¤±è´¥è‡ªåŠ¨é‡è¯•ï¼‰
  4. **è¶…æ—¶æ§åˆ¶**ï¼ˆè¯·æ±‚è¶…è¿‡æ—¶é—´è‡ªåŠ¨å¤±è´¥ï¼‰
  5. **é¡ºåºæ‰§è¡Œä»»åŠ¡**ï¼ˆæŒ‰é¡ºåºè¾“å‡ºç»“æœï¼‰
  
  ------
  
  ## ä¸ƒã€å¸¸è§è€ƒç‚¹ / æ˜“é”™ç‚¹
  
  1. `Promise` æ„é€ å‡½æ•°ä¸­ `resolve/reject` ç«‹å³æ‰§è¡Œ
  2. `then` æ€»æ˜¯å¼‚æ­¥ï¼ˆå¾®ä»»åŠ¡ï¼‰ï¼Œå³ä½¿ `resolve` æ˜¯åŒæ­¥çš„
  3. é“¾å¼è°ƒç”¨ä¸­å¼‚å¸¸ä¼šå†’æ³¡åˆ°æœ€è¿‘çš„ `catch`
  4. `Promise.all` å¤±è´¥ä¸€ä¸ªå°±ç«‹åˆ»å¤±è´¥
  5. `async/await` è¯­æ³•ç³–ï¼Œåº•å±‚è¿˜æ˜¯åŸºäº Promise
  
  ------
  
  âœ… è¿™æ ·ä½ å¯ä»¥å¿«é€ŸæŒæ¡ï¼š**æ¦‚å¿µ â†’ æœºåˆ¶ â†’ API â†’ æ‰‹å†™ â†’ åº”ç”¨ â†’ é¢è¯•è€ƒç‚¹**
  
  è¦ä¸è¦æˆ‘å¸®ä½ å†æ•´ç†ä¸€ä»½ **ã€ŒPromise + async/await é«˜é¢‘é¢è¯•é¢˜æ¸…å•ã€**ï¼Ÿè¿™æ ·å¯ä»¥æ‹¿æ¥ç›´æ¥åˆ·é¢˜ç»ƒä¹ ã€‚

#### 18.äº‹ä»¶å§”æ‰˜

- # JavaScript ä¸­çš„äº‹ä»¶å§”æ‰˜ä¸äº‹ä»¶å†’æ³¡æœºåˆ¶æ€»ç»“

  ---

  ## ğŸ“Œ ä¸€ã€ä»€ä¹ˆæ˜¯äº‹ä»¶å†’æ³¡ï¼ˆEvent Bubblingï¼‰

  äº‹ä»¶å†’æ³¡æ˜¯ DOM äº‹ä»¶ä¼ æ’­çš„**ç¬¬ä¸‰é˜¶æ®µ**ï¼ŒæŒ‡çš„æ˜¯ï¼š

  > å½“æŸä¸ªå…ƒç´ è§¦å‘äº‹ä»¶æ—¶ï¼Œè¯¥äº‹ä»¶ä¼šä»ç›®æ ‡å…ƒç´ å¼€å§‹ï¼Œæ²¿ç€ DOM æ ‘**é€å±‚å‘ä¸Šä¼ æ’­**åˆ° `document`ã€‚

  ### ğŸ§  äº‹ä»¶ä¼ æ’­çš„ä¸‰ä¸ªé˜¶æ®µï¼š

  1. **æ•è·é˜¶æ®µ**ï¼šä» `window` â†’ `document` â†’ æœ€å¤–å±‚ DOM â†’ ... â†’ ç›®æ ‡å…ƒç´ 
  2. **ç›®æ ‡é˜¶æ®µ**ï¼šäº‹ä»¶åˆ°è¾¾çœŸæ­£è§¦å‘çš„ç›®æ ‡å…ƒç´ 
  3. **å†’æ³¡é˜¶æ®µ**ï¼šä»ç›®æ ‡å…ƒç´ å¼€å§‹ï¼Œå‘ä¸Šä¼ æ’­åˆ°å…¶çˆ¶çº§ã€ç¥–å…ˆã€ç›´åˆ° `document`

  ğŸ“Œ **é»˜è®¤äº‹ä»¶æ˜¯åœ¨å†’æ³¡é˜¶æ®µè¢«è§¦å‘çš„ã€‚**

  ---

  ## âœ… ç¤ºä¾‹ï¼šäº‹ä»¶å†’æ³¡è¿‡ç¨‹

  HTML ç»“æ„ï¼š
  ```html
  <div id="parent">
    <button id="child">Click Me</button>
  </div>
  ```

  JavaScriptï¼š

  ```js
  document.getElementById('child').addEventListener('click', () => {
    console.log('child clicked');
  });
  document.getElementById('parent').addEventListener('click', () => {
    console.log('parent clicked');
  });
  ```

  ç‚¹å‡»æŒ‰é’®åè¾“å‡ºï¼š

  ```
  child clicked
  parent clicked
  ```

  ------

  ## ğŸ§  äºŒã€äº‹ä»¶å†’æ³¡çš„è®¾è®¡åŸç†

  ### ä¸ºä»€ä¹ˆæµè§ˆå™¨è¦è®¾è®¡â€œäº‹ä»¶å†’æ³¡â€æœºåˆ¶ï¼Ÿ

  1. **æ¨¡æ‹Ÿç°å®ä¸–ç•Œä¸­çš„ä¼ æ’­æ¨¡å‹**
     - æ¯”å¦‚ï¼šä½ æ‹æ°´é¢ï¼Œæ°´æ³¢ä¼šå‘å¤–æ‰©æ•£ï¼Œå†’æ³¡æ¨¡æ‹Ÿè¿™ç§â€œå±‚å±‚ä¼ é€’â€ã€‚
  2. **æé«˜æ€§èƒ½**
     - é¿å…æ¯ä¸ªå­èŠ‚ç‚¹éƒ½ç»‘å®šç›‘å¬å™¨ã€‚
  3. **å¢å¼ºçµæ´»æ€§**
     - çˆ¶ç»„ä»¶å¯ä»¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­ç»„ä»¶çš„äº‹ä»¶ã€‚
  4. **æ—©æœŸ IE å…ˆå®ç°äº†å†’æ³¡ï¼ŒW3C æ ‡å‡†ä¿ç•™äº†å®ƒ**

  ------

  ## ğŸ’¡ ä¸‰ã€ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼ˆEvent Delegationï¼‰

  äº‹ä»¶å§”æ‰˜æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯ï¼š

  > å°†æŸç±»å­å…ƒç´ çš„äº‹ä»¶ç»‘å®šï¼Œ**ç»Ÿä¸€å§”æ‰˜ç»™å®ƒä»¬çš„å…¬å…±ç¥–å…ˆå…ƒç´ **å¤„ç†ï¼Œåˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶ã€‚

  ### âœ… åœºæ™¯ï¼š

  - åˆ—è¡¨ä¸­æœ‰å¤§é‡ `<li>` é¡¹ç›®ï¼Œæ¯ä¸ªéƒ½å¯ç‚¹å‡»
  - è€Œä½ åªåœ¨ `<ul>` ä¸Šç»‘å®šç›‘å¬å™¨

  ```js
  document.getElementById('list').addEventListener('click', function (e) {
    if (e.target.tagName === 'LI') {
      console.log('ç‚¹å‡»äº†ï¼š', e.target.textContent);
    }
  });
  ```

  ------

  ## ğŸ” å››ã€äº‹ä»¶å§”æ‰˜çš„åŸç†å…³ç³»å›¾

  ```
  äº‹ä»¶è§¦å‘ (child å…ƒç´ ç‚¹å‡»)
     â†“
  äº‹ä»¶å†’æ³¡åˆ°çˆ¶å…ƒç´ 
     â†“
  çˆ¶å…ƒç´ ç›‘å¬å™¨è§¦å‘
     â†“
  æ ¹æ® e.target åˆ¤æ–­äº‹ä»¶æº
     â†“
  æ‰§è¡Œå¯¹åº”é€»è¾‘ï¼ˆå§”æ‰˜å¤„ç†ï¼‰
  ```

  ------

  ## ğŸ“ˆ äº”ã€äº‹ä»¶å§”æ‰˜çš„ä¼˜ç‚¹

  | ä¼˜ç‚¹           | è¯´æ˜                                             |
  | -------------- | ------------------------------------------------ |
  | å‡å°‘å†…å­˜æ¶ˆè€—   | ä¸éœ€è¦ä¸ºæ¯ä¸ªå­å…ƒç´ éƒ½ç»‘å®šç›‘å¬å™¨                   |
  | åŠ¨æ€å…ƒç´ æ”¯æŒ   | æ–°å¢çš„ DOM å…ƒç´ ä¹Ÿèƒ½è‡ªåŠ¨å“åº”äº‹ä»¶ï¼Œæ— éœ€é‡æ–°ç»‘å®š    |
  | æ›´æ–¹ä¾¿ç®¡ç†     | æ‰€æœ‰é€»è¾‘é›†ä¸­åœ¨çˆ¶å…ƒç´ ä¸€ä¸ªç›‘å¬å™¨ä¸­å®ç°ï¼Œä»£ç æ›´å¯æ§ |
  | é€‚ç”¨äºé«˜é¢‘æ“ä½œ | æ¯”å¦‚ï¼šåˆ†é¡µè¡¨æ ¼ã€åŠ¨æ€åˆ—è¡¨ã€æŒ‰é’®æ± ç­‰é¢‘ç¹æ›´æ–°åœºæ™¯   |

  ------

  ## â— å…­ã€äº‹ä»¶å§”æ‰˜çš„æ³¨æ„äº‹é¡¹

  1. **ä¾èµ–äº‹ä»¶å†’æ³¡æœºåˆ¶**ï¼Œå¦‚æœäº‹ä»¶ä¸èƒ½å†’æ³¡ï¼ˆå¦‚ `blur`ã€`focus`ï¼‰ï¼Œå°±ä¸èƒ½ç”¨äº‹ä»¶å§”æ‰˜ï¼›
  2. **`e.target` å¯èƒ½ä¸æ˜¯ä½ æœŸæœ›çš„å…ƒç´ **ï¼Œéœ€è¦åŠ æ¡ä»¶åˆ¤æ–­ï¼›
  3. å§”æ‰˜å±‚çº§ä¸å®œå¤ªé«˜ï¼Œå¦åˆ™åˆ¤æ–­é€»è¾‘ä¼šå˜å¤æ‚ï¼›
  4. åµŒå¥—ç»“æ„ä¸­æ³¨æ„ `stopPropagation()` ä¼šä¸­æ–­å†’æ³¡é“¾ã€‚

  ------

  ## ğŸ” ä¸ƒã€äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶å§”æ‰˜çš„åŒºåˆ«ä¸è”ç³»

  | é¡¹ç›®         | äº‹ä»¶å†’æ³¡                   | äº‹ä»¶å§”æ‰˜                              |
  | ------------ | -------------------------- | ------------------------------------- |
  | æœ¬è´¨         | æµè§ˆå™¨äº‹ä»¶ä¼ æ’­æœºåˆ¶çš„ä¸€éƒ¨åˆ† | ä¸€ç§åˆ©ç”¨äº‹ä»¶å†’æ³¡çš„ç¼–ç æŠ€å·§            |
  | ç”±è°å†³å®š     | æµè§ˆå™¨å†…éƒ¨æœºåˆ¶             | å¼€å‘è€…æ‰‹åŠ¨å®ç°                        |
  | æ˜¯å¦è‡ªåŠ¨å‘ç”Ÿ | è‡ªåŠ¨å‘ç”Ÿ                   | éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å§”æ‰˜                    |
  | æ˜¯å¦ä¾èµ–å†’æ³¡ | æœ¬èº«å°±æ˜¯å†’æ³¡               | âœ… å®Œå…¨ä¾èµ–å†’æ³¡æœºåˆ¶                    |
  | åº”ç”¨ç›®çš„     | å®šä¹‰äº‹ä»¶ä¼ æ’­è·¯å¾„           | æé«˜æ€§èƒ½ã€ç®€åŒ–ä»£ç ã€æ”¯æŒåŠ¨æ€ DOM å…ƒç´  |

  ------

  ## âœ… å°ç»“å£è¯€

  > â€œ**äº‹ä»¶å†’æ³¡**æ˜¯æµè§ˆå™¨è¡Œä¸ºï¼Œäº‹ä»¶ä»é‡Œå‘å¤–ä¼ ï¼›
  >  **äº‹ä»¶å§”æ‰˜**æ˜¯å¼€å‘æŠ€å·§ï¼Œå€ŸåŠ©å†’æ³¡æ¥å°‘ç»‘ã€‚â€

  ------

- ä»¥ä¸‹æ˜¯äº‹ä»¶å§”æ‰˜çš„ç›¸å…³å†…å®¹ï¼Œéœ€è¦æŒæ¡

  ## ğŸ§© 1. `e.target` vs `e.currentTarget`

  è¿™ä¸¤ä¸ªå±æ€§å¸¸åœ¨äº‹ä»¶å§”æ‰˜ä¸­ç”¨æ¥åˆ¤æ–­äº‹ä»¶æ¥æºå’Œå¤„ç†è€…ã€‚

  | å±æ€§              | è¯´æ˜                                               |
  | ----------------- | -------------------------------------------------- |
  | `e.target`        | å®é™…**è§¦å‘äº‹ä»¶çš„å…ƒç´ **ï¼ˆæ¯”å¦‚ä½ ç‚¹äº†å“ªä¸ªå…·ä½“çš„æŒ‰é’®ï¼‰ |
  | `e.currentTarget` | å½“å‰ç»‘å®šäº‹ä»¶ç›‘å¬å™¨çš„**å…ƒç´ æœ¬èº«**                   |

  ### ç¤ºä¾‹ï¼š

  ```js
  document.getElementById('parent').addEventListener('click', function (e) {
    console.log('target:', e.target);
    console.log('currentTarget:', e.currentTarget);
  });
  <div id="parent">
    <button id="child">Click Me</button>
  </div>
  ```

  å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼š

  ```
  target: <button>        // å®é™…è¢«ç‚¹å‡»çš„å…ƒç´ 
  currentTarget: <div>    // å½“å‰ç»‘å®šäº‹ä»¶å¤„ç†å™¨çš„å…ƒç´ 
  ```

  ### ğŸ’¡ åœ¨äº‹ä»¶å§”æ‰˜ä¸­ï¼š

  - ä½ é€šå¸¸ä¼šç”¨ `e.target` æ¥åˆ¤æ–­æ˜¯å“ªä¸€ä¸ªå­å…ƒç´ è§¦å‘äº†äº‹ä»¶ï¼›
  - è€Œ `e.currentTarget` æ˜¯ä½ ç»‘å®šäº‹ä»¶çš„çˆ¶çº§å®¹å™¨ã€‚

  ------

  ## ğŸ›‘ 2. `stopPropagation()`

  ### ä½œç”¨ï¼š

  > é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡åˆ°æ›´é«˜å±‚çš„ç¥–å…ˆå…ƒç´ ã€‚

  ```js
  child.addEventListener('click', function (e) {
    e.stopPropagation();
    console.log('child clicked');
  });
  ```

  - äº‹ä»¶ä¼šåœ¨è¿™é‡Œåœæ­¢ï¼Œä¸ä¼šç»§ç»­å†’æ³¡åˆ°çˆ¶å…ƒç´ ã€‚

  ### âš ï¸ æ³¨æ„ï¼š

  - **ä¸ä¼šé˜»æ­¢å½“å‰å…ƒç´ ä¸Šçš„å…¶ä»–ç›‘å¬å™¨æ‰§è¡Œ**ï¼›
  - **ä¸å½±å“é»˜è®¤è¡Œä¸ºï¼ˆå¦‚è·³è½¬ï¼‰**ï¼Œè¦é˜»æ­¢é»˜è®¤è¡Œä¸ºè¯·ç”¨ `preventDefault()`ã€‚

  ------

  ## âŒ 3. `preventDefault()`

  ### ä½œç”¨ï¼š

  > é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼ˆä½†äº‹ä»¶æœ¬èº«ä»ä¼šç»§ç»­ä¼ æ’­ï¼‰ã€‚

  å¸¸è§ç”¨é€”ï¼š

  - é˜»æ­¢ `<a>` æ ‡ç­¾è·³è½¬
  - é˜»æ­¢ `<form>` è‡ªåŠ¨æäº¤
  - é˜»æ­¢å³é”®èœå•å‡ºç°ï¼ˆ`contextmenu`ï¼‰

  ```js
  document.querySelector('a').addEventListener('click', function (e) {
    e.preventDefault();
    console.log('é“¾æ¥è¢«ç‚¹å‡»ä½†æ²¡æœ‰è·³è½¬');
  });
  ```

  ------

  ## âš™ï¸ 4. `addEventListener` çš„ç¬¬ä¸‰ä¸ªå‚æ•° `{ capture: true }`

  è¿™æ˜¯ç”¨æ¥æ§åˆ¶äº‹ä»¶ç›‘å¬å™¨åœ¨å“ªä¸ªé˜¶æ®µè¢«è§¦å‘çš„ã€‚

  ```js
  element.addEventListener('click', handler, true); // æ•è·é˜¶æ®µè§¦å‘
  element.addEventListener('click', handler, false); // å†’æ³¡é˜¶æ®µï¼ˆé»˜è®¤ï¼‰
  ```

  ### è¯´æ˜ï¼š

  - `{ capture: true }` â†’ åœ¨**æ•è·é˜¶æ®µè§¦å‘**
  - `{ capture: false }` æˆ–çœç•¥ â†’ åœ¨**å†’æ³¡é˜¶æ®µè§¦å‘**

  ### ğŸ§  ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ

  - å°‘æ•°æƒ…å†µä¸‹ä½ æƒ³è¦â€œ**æŠ¢å…ˆå¤„ç†äº‹ä»¶**â€ï¼Œå¯ä»¥åœ¨æ•è·é˜¶æ®µå¤„ç†ã€‚
  - å¤§å¤šæ•°æ—¶å€™ä½¿ç”¨é»˜è®¤çš„å†’æ³¡é˜¶æ®µå³å¯ã€‚

  ------

  ## ğŸ§­ 5. å“ªäº›äº‹ä»¶å¯ä»¥å†’æ³¡ï¼Œå“ªäº›ä¸å¯ä»¥ï¼Ÿ

  ### âœ… ä¼šå†’æ³¡çš„å¸¸è§äº‹ä»¶ï¼š

  | ç±»åˆ«     | äº‹ä»¶                                                       |
  | -------- | ---------------------------------------------------------- |
  | é¼ æ ‡äº‹ä»¶ | `click`, `dblclick`, `mousedown`, `mouseup`, `contextmenu` |
  | è¡¨å•äº‹ä»¶ | `change`, `input`, `submit`                                |
  | é”®ç›˜äº‹ä»¶ | `keydown`, `keyup`, `keypress`                             |
  | å…¶ä»–     | `focusin`, `focusout`, `error`ï¼ˆéƒ¨åˆ†å†’æ³¡ï¼‰                 |

  ### âŒ ä¸ä¼šå†’æ³¡çš„äº‹ä»¶ï¼š

  | ç±»åˆ«     | äº‹ä»¶                     | è¯´æ˜                         |
  | -------- | ------------------------ | ---------------------------- |
  | è¡¨å•äº‹ä»¶ | `focus`, `blur`          | æ”¹ç”¨ `focusin` å’Œ `focusout` |
  | åª’ä½“äº‹ä»¶ | `play`, `pause`, `ended` | å¤šä¸ºè§†é¢‘/éŸ³é¢‘ç›¸å…³            |
  | åŠ¨ç”»äº‹ä»¶ | `transitionend`ï¼ˆéƒ¨åˆ†ï¼‰  | è¦æ³¨æ„å…¼å®¹æ€§                 |

  ------

  ## âœ… å°ç»“å£è¯€

  | é¡¹ç›®                | å»ºè®®è®°ä½çš„ç‚¹                        |
  | ------------------- | ----------------------------------- |
  | `e.target`          | è°è§¦å‘äº‹ä»¶                          |
  | `e.currentTarget`   | è°åœ¨ç›‘å¬å¤„ç†                        |
  | `stopPropagation()` | é˜»æ­¢äº‹ä»¶ç»§ç»­å¾€ä¸Šå†’æ³¡                |
  | `preventDefault()`  | é˜»æ­¢é»˜è®¤æµè§ˆå™¨è¡Œä¸ºï¼ˆå¦‚è·³è½¬ï¼‰        |
  | `{ capture: true }` | åœ¨æ•è·é˜¶æ®µè§¦å‘ç›‘å¬å™¨                |
  | å†’æ³¡äº‹ä»¶            | click/input/change ç­‰å¤šæ•°äº¤äº’å‹äº‹ä»¶ |
  | ä¸å†’æ³¡äº‹ä»¶          | focus/blur/play ç­‰ç‰¹æ®Šäº‹ä»¶          |

#### 19.å¯¹è±¡æ‰å¹³åŒ–ä¸è¿˜åŸ

- ## é¢˜ç›®ä¸€ï¼šå¯¹è±¡æ‰å¹³åŒ–ï¼ˆflattenï¼‰

  ### è¦æ±‚

  å®ç°ä¸€ä¸ªå‡½æ•° `flatten(obj)`ï¼Œå°†å¤šå±‚åµŒå¥—çš„å¯¹è±¡è½¬ä¸ºä¸€å±‚å¯¹è±¡ï¼Œé”®åç”¨è·¯å¾„è¡¨ç¤ºã€‚

  ### ç¤ºä¾‹

  ```js
  const input = {
    a: { b: { c: 1 }, d: 2 },
    e: 3
  };
  
  flatten(input);
  // => { "a.b.c": 1, "a.d": 2, "e": 3 }
  ```

  ### çŸ¥è¯†ç‚¹

  1. **é€’å½’**ï¼šé‡åˆ°å¯¹è±¡ç»§ç»­å±•å¼€ï¼Œå¦åˆ™ç›´æ¥èµ‹å€¼ã€‚
  2. **é”®åæ‹¼æ¥**ï¼š
     - å¯¹è±¡å±æ€§ â†’ `parent.key`
     - æ•°ç»„ç´¢å¼• â†’ `parent[index]`
  3. **ç±»å‹åˆ¤æ–­**ï¼š
     - `typeof value === 'object' && value !== null` â†’ ç»§ç»­é€’å½’
     - `Array.isArray(value)` åŒºåˆ†æ•°ç»„
  4. **å±æ€§éå†æ–¹å¼**ï¼š
     - `for...in` + `hasOwnProperty`ï¼ˆä¼šåŒ…å«åŸå‹é“¾å±æ€§ï¼‰
     - `Object.keys/values/entries`ï¼ˆåªå–è‡ªèº«å±æ€§ï¼Œæ¨èï¼‰

  ------

  ## é¢˜ç›®äºŒï¼šå¯¹è±¡è¿˜åŸï¼ˆunflattenï¼‰

  ### è¦æ±‚

  å®ç°ä¸€ä¸ªå‡½æ•° `unflatten(obj)`ï¼Œå°†æ‰å¹³å¯¹è±¡è¿˜åŸä¸ºåµŒå¥—å¯¹è±¡ã€‚

  ### ç¤ºä¾‹

  ```js
  const flat = {
    "a.b.c": 1,
    "a.d": 2,
    "arr[0].name": "Tom",
    "arr[0].age": 18,
    "arr[1].name": "Jerry"
  };
  
  unflatten(flat);
  // => { a: { b: { c: 1 }, d: 2 }, arr: [ { name: "Tom", age: 18 }, { name: "Jerry" } ] }
  ```

  ### çŸ¥è¯†ç‚¹

  1. **è·¯å¾„è§£æ**

     - ç®€å•ç‰ˆï¼š`"a.b.c".split('.') â†’ ["a","b","c"]`

     - é«˜çº§ç‰ˆï¼šè§£æ `arr[0].name` â†’ `["arr","0","name"]`

       ```js
       function parsePath(path) {
         return path.replace(/\[(\w+)\]/g, '.$1').split('.');
       }
       ```

  2. **å¼•ç”¨èµ‹å€¼**

     - `current` æŒ‡é’ˆåœ¨ `result` å†…æ¸¸èµ°å¹¶ä¿®æ”¹ï¼Œæœ€ç»ˆå€¼å†™å…¥ `result`ã€‚
     - é€šè¿‡å¼•ç”¨ä¿®æ”¹åµŒå¥—å¯¹è±¡ â†’ `result` è‡ªåŠ¨æ›´æ–°ã€‚

  3. **è‡ªåŠ¨å»ºå±‚**

     - å¦‚æœä¸‹ä¸€å±‚æ˜¯æ•°å­— â†’ å»º `[]`
     - å¦åˆ™ â†’ å»º `{}`
     - æœ€åä¸€å±‚ç›´æ¥èµ‹å€¼

  ------

  ## ğŸ”¹ å¯¹è±¡éå†æ–¹å¼æ€»ç»“

  | æ–¹æ³•                   | æ˜¯å¦éå†åŸå‹é“¾ | æ˜¯å¦è¿”å›æ•°ç»„ | é¡ºåºæ˜¯å¦å›ºå®š  | æ”¯æŒ Symbol é”® |
  | ---------------------- | -------------- | ------------ | ------------- | -------------- |
  | `for...in`             | âœ…ï¼ˆéœ€è¿‡æ»¤ï¼‰    | âŒ            | ä¸å®Œå…¨ä¿è¯    | âŒ              |
  | `Object.keys(obj)`     | âŒ              | âœ…            | âœ…ï¼ˆæ’å…¥é¡ºåºï¼‰ | âŒ              |
  | `Object.values(obj)`   | âŒ              | âœ…            | âœ…             | âŒ              |
  | `Object.entries(obj)`  | âŒ              | âœ…            | âœ…             | âŒ              |
  | `Reflect.ownKeys(obj)` | âŒ              | âœ…            | âœ…             | âœ…              |

  ğŸ‘‰ å®é™…å¼€å‘ä¸­ï¼Œæ¨è `Object.keys / entries`ï¼Œé¿å…åŸå‹é“¾å¹²æ‰°ã€‚

  ------

  ## ğŸ”¹ flatten â†” unflatten åŒå‘éªŒè¯

  ```js
  const obj = {
    a: { b: { c: 1 }, d: 2 },
    arr: [{ name: "Tom", age: 18 }, { name: "Jerry" }]
  };
  
  const flat = flatten(obj);
  console.log(flat);
  
  const restored = unflatten(flat);
  console.log(restored);
  
  // éªŒè¯ï¼šdeepEqual(obj, restored) === true
  ```

  ------

  ```javascript
  // è¿™æ˜¯è¿›é˜¶ç‰ˆæœ¬çš„æ‰å¹³åŒ–å’Œè¿˜åŸ
  ç‰¹ç‚¹
  
  âœ… æ”¯æŒ å¯¹è±¡ / æ•°ç»„
  
  âœ… æ”¯æŒ arr[0].xxx é£æ ¼è·¯å¾„
  
  âœ… æ”¯æŒ Symbol é”® / ä¸å¯æšä¸¾å±æ€§
  
  âœ… æ”¯æŒ å¾ªç¯å¼•ç”¨æ£€æµ‹ï¼ˆè¿”å› "__CIRCULAR__"ï¼‰
  
  âœ… æ”¯æŒ Set / Map / Date / RegExp ç±»å‹ä¿ç•™
  
  âœ… å¯é…ç½®åŒ–ï¼ˆåˆ†éš”ç¬¦ã€æ˜¯å¦ç”¨ä¸­æ‹¬å·ã€æ˜¯å¦ä¿ç•™ç±»å‹ä¿¡æ¯ï¼‰
  // =====================
  // ğŸ”¹ Flatten
  // =====================
  function flatten(obj, parentKey = '', result = {}, options = {}) {
    const {
      arrayBrackets = true,     // æ˜¯å¦ä½¿ç”¨ arr[0] é£æ ¼ï¼ˆfalse = arr.0ï¼‰
      separator = '.',          // å¯¹è±¡åˆ†éš”ç¬¦
      detectType = true,        // æ˜¯å¦ä¿ç•™ç±»å‹ä¿¡æ¯ (Date, RegExp, etc.)
      seen = new WeakSet()      // é˜²æ­¢å¾ªç¯å¼•ç”¨
    } = options;
  
    if (obj !== null && typeof obj === 'object') {
      if (seen.has(obj)) {
        // â›” é¿å…å¾ªç¯å¼•ç”¨
        result[parentKey] = '__CIRCULAR__';
        return result;
      }
      seen.add(obj);
  
      if (Array.isArray(obj)) {
        obj.forEach((item, index) => {
          const newKey = parentKey
            ? arrayBrackets
              ? `${parentKey}[${index}]`
              : `${parentKey}${separator}${index}`
            : `${arrayBrackets ? `[${index}]` : index}`;
  
          flatten(item, newKey, result, options);
        });
      } else if (obj instanceof Date) {
        result[parentKey] = detectType ? { __type: 'Date', value: obj.toISOString() } : obj.toISOString();
      } else if (obj instanceof RegExp) {
        result[parentKey] = detectType ? { __type: 'RegExp', value: obj.toString() } : obj.toString();
      } else if (obj instanceof Set) {
        result[parentKey] = detectType ? { __type: 'Set', value: [...obj] } : [...obj];
      } else if (obj instanceof Map) {
        result[parentKey] = detectType ? { __type: 'Map', value: [...obj.entries()] } : [...obj.entries()];
      } else {
        Object.getOwnPropertyNames(obj).forEach(key => {
          const newKey = parentKey ? `${parentKey}${separator}${key}` : key;
          flatten(obj[key], newKey, result, options);
        });
        Object.getOwnPropertySymbols(obj).forEach(sym => {
          const symKey = parentKey ? `${parentKey}${separator}${sym.toString()}` : sym.toString();
          flatten(obj[sym], symKey, result, options);
        });
      }
    } else {
      result[parentKey] = obj;
    }
  
    return result;
  }
  
  
  // =====================
  // ğŸ”¹ Unflatten
  // =====================
  function unflatten(flatObj, options = {}) {
    const {
      separator = '.',
      arrayBrackets = true
    } = options;
  
    const result = {};
  
    const parsePath = (path) => {
      if (arrayBrackets) {
        // arr[0].name -> ["arr", "0", "name"]
        return path.replace(/\[(\w+)\]/g, `${separator}$1`).split(separator);
      } else {
        return path.split(separator);
      }
    };
  
    for (let flatKey in flatObj) {
      if (!flatObj.hasOwnProperty(flatKey)) continue;
      const keys = parsePath(flatKey);
      let current = result;
  
      keys.forEach((key, index) => {
        const isLast = index === keys.length - 1;
        const nextKey = keys[index + 1];
        const value = flatObj[flatKey];
  
        if (isLast) {
          // ç±»å‹è¿˜åŸ
          if (value && typeof value === 'object' && value.__type) {
            switch (value.__type) {
              case 'Date': current[key] = new Date(value.value); break;
              case 'RegExp': current[key] = new RegExp(value.value.slice(1, -1)); break;
              case 'Set': current[key] = new Set(value.value); break;
              case 'Map': current[key] = new Map(value.value); break;
              default: current[key] = value.value;
            }
          } else {
            current[key] = value;
          }
        } else {
          if (!(key in current)) {
            const isArrayIndex = !isNaN(Number(nextKey));
            current[key] = isArrayIndex ? [] : {};
          }
          current = current[key];
        }
      });
    }
  
    return result;
  }
  
  
  ```

  

  ## æ€»ç»“

  - **flatten** è€ƒå¯Ÿé€’å½’ã€å¯¹è±¡/æ•°ç»„éå†ã€é”®åæ‹¼æ¥ã€‚
  - **unflatten** è€ƒå¯Ÿå­—ç¬¦ä¸²è§£æã€åŠ¨æ€å»ºå±‚ã€å¼•ç”¨èµ‹å€¼ã€‚
  - **å»¶ä¼¸çŸ¥è¯†ç‚¹**ï¼š
    - å¯¹è±¡å±æ€§éå†æ–¹å¼å·®å¼‚
    - `current` ä½œä¸ºâ€œæ¸¸æ ‡â€ä¿®æ”¹ `result` çš„åŸç†
    - è·¯å¾„è¯­æ³•é£æ ¼ï¼ˆ`a.0.b` vs `a[0].b`ï¼‰
